# Day 14: Restroom Redoubt

## Part 1

### Working with Sample Data

This is the sample data that we've been given:

````julia
sample = """
p=0,4 v=3,-3
p=6,3 v=-1,-3
p=10,3 v=-1,2
p=2,0 v=2,-1
p=0,0 v=1,3
p=3,0 v=-2,-2
p=7,6 v=-1,-3
p=3,0 v=-1,-2
p=9,3 v=2,3
p=7,3 v=-1,2
p=2,4 v=2,-3
p=9,5 v=-3,-3
"""
````

````
"p=0,4 v=3,-3\np=6,3 v=-1,-3\np=10,3 v=-1,2\np=2,0 v=2,-1\np=0,0 v=1,3\np=3,0 v=-2,-2\np=7,6 v=-1,-3\np=3,0 v=-1,-2\np=9,3 v=2,3\np=7,3 v=-1,2\np=2,4 v=2,-3\np=9,5 v=-3,-3\n"
````

This is a single robot that we can use to test our simulation of movement.

````julia
single = """
p=2,4 v=2,-3
"""
````

````
"p=2,4 v=2,-3\n"
````

This is a struct to capture the information we need about each individual
robot.

````julia
@kwdef struct Robot
    # These are the position of the robot
    x::Int
    y::Int
    # These represent the velocity of the robot
    vx::Int
    vy::Int
end
````

````
Main.var"##235".Robot
````

This function parses our data into a vector of robots

````julia
function parse_robots(data)
    robots = []
    lines = split(data, "\n")
    for line in lines
        if startswith(line, "p=")
            (pos, vel) = split(line, " ")
            (x, y) = split(pos[3:end], ",")
            (vx, vy) = split(vel[3:end], ",")
            r = Robot(parse(Int, x), parse(Int, y), parse(Int, vx), parse(Int, vy))
            push!(robots, r)
        end
    end
    robots
end
````

````
parse_robots (generic function with 1 method)
````

Let's parse our sample robot information and check that it looks right:

````julia
parse_robots(sample)
````

````
12-element Vector{Any}:
 Main.var"##235".Robot(0, 4, 3, -3)
 Main.var"##235".Robot(6, 3, -1, -3)
 Main.var"##235".Robot(10, 3, -1, 2)
 Main.var"##235".Robot(2, 0, 2, -1)
 Main.var"##235".Robot(0, 0, 1, 3)
 Main.var"##235".Robot(3, 0, -2, -2)
 Main.var"##235".Robot(7, 6, -1, -3)
 Main.var"##235".Robot(3, 0, -1, -2)
 Main.var"##235".Robot(9, 3, 2, 3)
 Main.var"##235".Robot(7, 3, -1, 2)
 Main.var"##235".Robot(2, 4, 2, -3)
 Main.var"##235".Robot(9, 5, -3, -3)
````

This function updates our robots to their new positions after `t` seconds.

````julia
function after(robots, t, width, height)
    for i in 1:t
        robots = [Robot(mod(r.x + r.vx, width), mod(r.y + r.vy, height), r.vx, r.vy) for r in robots]
    end
    robots
end
````

````
after (generic function with 1 method)
````

Write a function to count how many robots are in each location:

````julia
function tally_robots(robots, width, height)
    grid = fill(0, height, width)
    for r in robots
        grid[r.y+1, r.x+1] += 1
    end
    grid
end
````

````
tally_robots (generic function with 1 method)
````

This function is useful for visualizing a collection of robots.

````julia
function visualize(robots, width, height)
    grid = tally_robots(robots, width, height)
    mx = div(width - 1, 2)
    my = div(height - 1, 2)
    rows = []
    for i in 1:height
        if i == my + 1
            push!(rows, "="^(width + 2))
        end
        push!(rows, "$(join(grid[i, 1:mx-1], ""))|$(grid[i, mx])|$(join(grid[i, mx+1:end], ""))")
        if i == my + 1
            push!(rows, "="^(width + 2))
        end
    end
    rows
end
````

````
visualize (generic function with 1 method)
````

These are the first few frames of simulation of the single robot:

````julia
visualize(after(parse_robots(single), 0, 11, 7), 11, 7)
````

````
9-element Vector{Any}:
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000000"
 "============="
 "0000|0|000000"
 "============="
 "0010|0|000000"
 "0000|0|000000"
 "0000|0|000000"
````

After one second, the robot is here:

````julia
visualize(after(parse_robots(single), 1, 11, 7), 11, 7)
````

````
9-element Vector{Any}:
 "0000|0|000000"
 "0000|1|000000"
 "0000|0|000000"
 "============="
 "0000|0|000000"
 "============="
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000000"
````

After two seconds:

````julia
visualize(after(parse_robots(single), 2, 11, 7), 11, 7)
````

````
9-element Vector{Any}:
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000000"
 "============="
 "0000|0|000000"
 "============="
 "0000|0|000000"
 "0000|0|010000"
 "0000|0|000000"
````

After three seconds:

````julia
visualize(after(parse_robots(single), 3, 11, 7), 11, 7)
````

````
9-element Vector{Any}:
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000100"
 "============="
 "0000|0|000000"
 "============="
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000000"
````

After four seconds:

````julia
visualize(after(parse_robots(single), 4, 11, 7), 11, 7)
````

````
9-element Vector{Any}:
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000000"
 "============="
 "0000|0|000000"
 "============="
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000001"
````

After five seconds:

````julia
visualize(after(parse_robots(single), 5, 11, 7), 11, 7)
````

````
9-element Vector{Any}:
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000000"
 "============="
 "0100|0|000000"
 "============="
 "0000|0|000000"
 "0000|0|000000"
 "0000|0|000000"
````

This function computes the safety factor required to solve part 1.

````julia
function safety_factor(robots, t, width, height)
    robots = after(robots, t, width, height)
    q1 = 0
    q2 = 0
    q3 = 0
    q4 = 0
    mx = div(width - 1, 2)
    my = div(height - 1, 2)
    for r in robots
        if r.x < mx && r.y < my
            q1 += 1
        end
        if r.x > mx && r.y < my
            q2 += 1
        end
        if r.x < mx && r.y > my
            q3 += 1
        end
        if r.x > mx && r.y > my
            q4 += 1
        end
    end
    (q1 * q2 * q3 * q4, q1, q2, q3, q4)
end

safety_factor(parse_robots(sample), 0, 11, 7)
````

````
(0, 4, 0, 2, 2)
````

After 100 seconds the robots are in the following position:

````julia
sample_robots = parse_robots(sample)
robots100 = after(sample_robots, 100, 11, 7)
````

````
12-element Vector{Main.var"##235".Robot}:
 Main.var"##235".Robot(3, 5, 3, -3)
 Main.var"##235".Robot(5, 4, -1, -3)
 Main.var"##235".Robot(9, 0, -1, 2)
 Main.var"##235".Robot(4, 5, 2, -1)
 Main.var"##235".Robot(1, 6, 1, 3)
 Main.var"##235".Robot(1, 3, -2, -2)
 Main.var"##235".Robot(6, 0, -1, -3)
 Main.var"##235".Robot(2, 3, -1, -2)
 Main.var"##235".Robot(0, 2, 2, 3)
 Main.var"##235".Robot(6, 0, -1, 2)
 Main.var"##235".Robot(4, 5, 2, -3)
 Main.var"##235".Robot(6, 6, -3, -3)
````

When visualized, their locations look like this:

````julia
visualize(robots100, 11, 7)
````

````
9-element Vector{Any}:
 "0000|0|020010"
 "0000|0|000000"
 "1000|0|000000"
 "============="
 "0110|0|000000"
 "============="
 "0000|0|100000"
 "0001|2|000000"
 "0100|0|010000"
````

The safety factor would then be:

````julia
safety_factor(parse_robots(sample), 100, 11, 7)
````

````
(12, 1, 3, 4, 1)
````

### Working with Actual Data

Now let's load our actual data and compute the safety factor for that:

````julia
data = read("day14.txt", String);

safety_factor(parse_robots(data), 100, 101, 103)
````

````
(233709840, 116, 123, 126, 130)
````

Fantastic, the answer is $233709840$.

## Part 2

````julia
actual_robots = parse_robots(data);
````

Now we need to figure out how much time needs to elapse before the
robots form a christmas tree.

````julia
function time_to_tree(data)
    actual_robots = parse_robots(data)
    best = copy(actual_robots)
    best_total = 1
    best_time = 0

    for t in 1:100000
        actual_robots = after(actual_robots, 1, 101, 103)
        tally = tally_robots(actual_robots, 101, 103)
        unique = count(x -> x === 1, tally)
        if unique > best_total
            best = copy(actual_robots)
            best_total = unique
            best_time = t
        end
    end
    (best_time, best)
end

(tree_time, tree) = time_to_tree(data)

tree_time
````

````
6620
````

The time at which the robots form a christmas tree is $6620$ seconds and this
is the tree:

````julia
visualize(tree, 101, 103)
````

````
105-element Vector{Any}:
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000100000000000000000000000"
 "0000000000000000000001000000000000000000000000000|0|000000000000000000000001000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000001000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000010010000000000000000000001|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000100000000000"
 "0000000000000000000000000000000000000000010000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000100000000000000100000000000000000|0|000000000000000000000000000000000000000001000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000010000000000000001000|0|000000000000000000000000000000100000000000000000000"
 "0000000000000000000000000000000000000000000010000|0|000000000000000000001000000000000010000010000000000"
 "0000000000000000000000000000000000000000000000000|0|000000010000000000000000100000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000010000000000000000000000000000000000"
 "0000000000010000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000100000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000010000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000010000000000100000|0|000000000000000000000000010000000000000000000000000"
 "0100000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000010"
 "0000000000000000000000000001000100000000000100000|0|000000000000000000000000000000000000000000000000000"
 "0001000000000000000000000000000000000000000000000|0|000000000000000000000000000000000100000000000000000"
 "0000000000000000000000000000100000010000000000000|0|000000000000000000001000000000000000000000000000000"
 "0010000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000001000000"
 "0000000000000000000000000000000000000000000000000|0|001000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000001010000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "1000000000000000000000000000100000000000000000000|0|000000000000000000000000000000001000000000000000000"
 "0000010000000000000000000000000000000000000000000|0|001000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000110000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000001|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000100000000000000000000000000|0|000000000000001000000000000000000000000000000000000"
 "0000000000010000000000000000000000000000000000000|0|000000000000001000000000000000000000000000000000000"
 "0000001000000000000000000000000000000000000000000|0|000000000000010000000000000000000000000000000000000"
 "0000000000000000100000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000100000000000000000000"
 "0000000010000000000000000001000000000000000000000|0|000000100000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000010"
 "1000000000100000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0001000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|001000000010000000000000000000000001000000000000000"
 "0000000010000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000010000000000000000000010000"
 "0000000000000000000000000000000010000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000001000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000010000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000100000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000001000100|0|000000000001000000000000000000100000000000000000000"
 "1000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000100000000"
 "======================================================================================================="
 "0000000000000000000000000000000000001000000000000|0|000000000000000000000000000000000000000000000000000"
 "======================================================================================================="
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "1000000000000000000000000000000000010000000000000|0|011111111111111111111111111111110000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000000000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000000000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000000000000000000010000000000000000000"
 "0000000000000000000000000000000000000101000000000|0|010000000000000000000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000010000000000000010001000000000000000"
 "1000000000000000000000000000000000000000000000000|0|010000000000000111000000000000010000000000000000000"
 "0000000000000000000010000000000000000000000000000|0|010000000000001111100000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000011111110000000000010100001000000000000"
 "0000000000000000000010000000000000000000001000000|0|010000000000111111111000000000010000000000100000000"
 "0000000000000000000000000000100000000000000000000|0|010000000000001111100000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000011111110000000000010000000010000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000111111111000000000010000010100000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000001111111111100000000010000000000000100000"
 "0000000000000010000000000000000000000000000000000|0|010000000011111111111110000000010000000000000000010"
 "0000000010000001000000000000000000000000000000000|0|010000000000111111111000000000010000000000000000000"
 "0000000000100000000000000000000000010000000010000|0|010000000001111111111100000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000011111111111110000000010000000000000000001"
 "0000000000000000001100000000000000000000000001000|0|010000000111111111111111000000010000001000000000000"
 "0000000000001000000100010000000000000000000000001|0|010000001111111111111111100000010000001000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000011111111111110000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000111111111111111000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000001111111111111111100000010100000000000000000"
 "0000000000000000000000000000000000000000000000000|1|010000011111111111111111110000010000000000000000000"
 "0000000000000000000000000000000000011000001000000|0|010000111111111111111111111000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000111000000000000010000000000000000000"
 "0001000000010000000000000000000000000000000000000|0|010000000000000111000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000111000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000000000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000000000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|010000000000000000000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000000000|1|010000000000000000000000000000010000000000000000000"
 "0000000000000000000000000000000000000000000100000|0|011111111111111111111111111111110000000000000010000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000001000000000000000"
 "0000000000000000000000000010000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000100000000000000000000000000000|0|000000000000000000000001000010000000000000000000000"
 "0000000000000000000000000000010000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000100000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000001000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000001000000000000000000000000000000000000000000"
 "0000000000000000000000001000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000001000000000000000011000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000010000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000000"
 "0000000000000000000000000000000000000000000000000|0|000000000000000000000000000000000000000000000000001"
 "0000000000000000000000000000000000000100000001000|0|000000000000000000000000000000000000000000000000100"
 "0000000000000000000000000000000000000000000000000|0|001000000000000000001000000000000000000000000000000"
````

### Working with Sample Data

### Working with Actual Data

---

*This page was generated using [Literate.jl](https://github.com/fredrikekre/Literate.jl).*

